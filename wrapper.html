<script type="module">
  import Chatbot from 'https://cdn.jsdelivr.net/npm/flowise-embed@latest/dist/web.js';

  // Get Teams user context first
  import { app as teamsApp } from 'https://res.cdn.office.net/teams-js/2.15.0/js/MicrosoftTeams.min.js';

  await teamsApp.initialize();
  const ctx = await teamsApp.getContext();

  Chatbot.init({
    chatflowid: 'b3c1c4b8-a30a-4a6e-955e-a0682cf24d94',
    apiHost: 'https://cloud.flowiseai.com',
    chatflowConfig: {
      vars: {
        name:        ctx.user?.displayName ?? '',
        department:  (ctx.user?.userPrincipalName ?? '').split('@')[0]
      }
    }
  });
</script>
